module.exports=[23163,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(15618),e=a.i(92e3),f=a.i(87532),g=a.i(46842),h=a.i(33508),i=a.i(33441),j=a.i(23821),k=a.i(57894),l=a.i(6704),m=a.i(60779),n=a.i(3849),o=a.i(75147);a.s(["default",0,()=>{let[a,p]=(0,c.useState)({quantity:"",category_id:"",warehouse_id:"",moisture_content:"",transaction_type:"deposit",farmerId:""}),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!1),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)("name"),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),[M,N]=(0,c.useState)(null),O=async a=>{let b;if(a.length<2)return void F([]);J(!0);let c=(b=a.trim()).includes("@")?"email":/^[\d\s\-\+]+$/.test(b)&&b.replace(/\D/g,"").length>=7?"phone_number":/^SGB\d{10}$/i.test(b)?"userId":"name";D(c);try{let b=`${c}=${encodeURIComponent(a)}`,d=await fetch(`${m.default}/user/finduserdetails?${b}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),e=await d.json();e.users&&Array.isArray(e.users)?F(e.users):e.user?F([e.user]):F([]),L(!0)}catch(a){console.error("Search error:",a),l.default.error("Error searching users",a.message),F([]),L(!0)}finally{J(!1)}};(0,c.useEffect)(()=>{let a=setTimeout(()=>{A?O(A):(F([]),L(!1))},500);return()=>clearTimeout(a)},[A]);let P=async()=>{z(!0);try{let a=await fetch(`${m.default}/grain/allgraincategories`);if(!a.ok)throw Error("Failed to fetch grain types");let b=await a.json();a.ok&&r(b)}catch(a){console.error(a),l.default.error("Failed to load grain categories")}finally{z(!1)}},Q=async()=>{z(!0);try{let a=await fetch(`${m.default}/warehouse/allwarehouse`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(!a.ok)throw Error("Failed to fetch warehouses");let b=await a.json();a.ok&&t(b.data)}catch(a){console.error(a),l.default.error("Failed to load warehouses")}finally{z(!1)}},R=async()=>{try{let b=await fetch(`${m.default}/pricehistory/pricehistorybygrain?id=${a.category_id}`);if(!b.ok)throw Error("Failed to fetch today's market price");let c=await b.json();b.ok&&N(c)}catch(a){console.error(a),l.default.error("Failed to load today's market price")}};(0,c.useEffect)(()=>{P(),Q()},[]),(0,c.useEffect)(()=>{a.category_id&&R()},[a.category_id]);let S=async()=>{if(!a.farmerId)return void l.default.error("Please select a farmer");if(!a.category_id||!a.warehouse_id||!a.quantity||!a.moisture_content)return void l.default.error("Please fill all required fields");let b=parseFloat(a.moisture_content);if(isNaN(b)||b<0||b>100)return void l.default.error("Moisture content must be between 0 and 100%");try{let b={farmerId:a.farmerId,warehouse_id:a.warehouse_id,category_id:a.category_id,quantity:a.quantity,current_price:M?.price,moisture_content:a.moisture_content,transaction_type:a.transaction_type},c=await fetch(`${m.default}/deposite/graindeposite`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify(b)}),d=await c.json();c.ok?(l.default.success("Deposit submitted successfully"),p({quantity:"",category_id:"",warehouse_id:"",farmerId:"",moisture_content:"",transaction_type:"deposit"}),H(null),v(!1)):l.default.error(d.message||"Failed to submit deposit")}catch(a){console.error(a),l.default.error("Error while submitting deposit")}};return y?(0,b.jsx)(o.default,{}):(0,b.jsxs)(b.Fragment,{children:[u&&w&&(0,b.jsx)(n.default,{isOpen:u,onClose:()=>v(!1),confirmationData:w,onConfirm:S}),(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-lg p-6 border border-gray-100",children:[(0,b.jsxs)("h2",{className:"text-2xl font-bold mb-6 flex items-center text-gray-800",children:[(0,b.jsx)("div",{className:"p-2 bg-green-100 rounded-lg mr-3",children:(0,b.jsx)(d.Plus,{className:"h-6 w-6 text-green-600"})}),"New Grain Deposit"]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 p-5 rounded-xl border border-blue-200",children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-3",children:["Select Farmer ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),G?(0,b.jsx)("div",{className:"bg-white rounded-lg border-2 border-green-200 p-4",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:G.user_image?(0,b.jsx)("img",{src:G.user_image,alt:G.name,className:"w-12 h-12 rounded-full object-cover border-2 border-green-200"}):(0,b.jsx)("div",{className:"w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-white font-bold text-lg",children:G.name?.charAt(0).toUpperCase()||"U"})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("p",{className:"font-semibold text-gray-900 flex items-center",children:[G.name||"Unknown User",(0,b.jsx)(i.Check,{className:"ml-2 h-5 w-5 text-green-500"})]}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:G.email||"No email"}),G.phone_number&&(0,b.jsx)("p",{className:"text-xs text-gray-400",children:G.phone_number}),G.userId&&(0,b.jsxs)("p",{className:"text-xs text-blue-600 font-medium",children:["ID: ",G.userId]})]})]}),(0,b.jsx)("button",{onClick:()=>{H(null),p({...a,farmerId:""}),B("")},className:"p-2 hover:bg-red-50 rounded-lg transition-colors group",title:"Remove farmer",children:(0,b.jsx)(h.X,{className:"h-5 w-5 text-gray-400 group-hover:text-red-500"})})]})}):(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(f.Search,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),(0,b.jsx)("input",{type:"text",className:"w-full pl-10 pr-4 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all",placeholder:"Search by name, email, phone number, or user ID...",value:A,onChange:a=>B(a.target.value),onFocus:()=>A&&L(!0)}),I&&(0,b.jsx)("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-blue-500"})})]}),A&&(0,b.jsx)("div",{className:"mt-1",children:(0,b.jsx)("span",{className:"text-xs text-blue-600 font-medium",children:(()=>{switch(C){case"email":return"Searching by Email";case"phone_number":return"Searching by Phone";case"userId":return"Searching by User ID";default:return"Searching by Name"}})()})}),K&&E.length>0&&(0,b.jsx)("div",{className:"absolute z-10 w-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto",children:E.map((c,d)=>(0,b.jsxs)("div",{onClick:()=>{H(c),p({...a,farmerId:c._id||c.id}),B(""),L(!1),F([]),l.default.success(`Selected farmer: ${c.name}`)},className:"px-4 py-3 hover:bg-gray-50 cursor-pointer flex items-center space-x-3 transition-colors border-b border-gray-100 last:border-b-0",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:c.user_image?(0,b.jsx)("img",{src:c.user_image,alt:c.name,className:"w-10 h-10 rounded-full object-cover border-2 border-blue-200"}):(0,b.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-full flex items-center justify-center text-white font-semibold",children:c.name?.charAt(0).toUpperCase()||"U"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:c.name||"Unknown User"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:c.email||"No email"}),c.phone_number&&(0,b.jsx)("p",{className:"text-xs text-gray-400",children:c.phone_number}),c.farmerId&&(0,b.jsxs)("p",{className:"text-xs text-blue-600 font-medium",children:["ID: ",c.farmerId]})]}),(0,b.jsx)("div",{className:"flex-shrink-0",children:(0,b.jsx)("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded-full",children:"Select"})})]},c._id||c.id||d))}),K&&A&&0===E.length&&!I&&(0,b.jsx)("div",{className:"absolute z-10 w-full mt-2 bg-white rounded-lg shadow-xl border border-gray-200 p-4",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(g.User,{className:"h-8 w-8 text-gray-400 mx-auto mb-2"}),(0,b.jsx)("p",{className:"text-gray-500",children:"No farmers found"}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Try searching with different criteria"})]})})]}),(0,b.jsxs)("div",{className:"mt-3 text-xs text-gray-600",children:[(0,b.jsx)("p",{className:"font-medium mb-1",children:"Search Tips:"}),(0,b.jsxs)("ul",{className:"space-y-0.5",children:[(0,b.jsx)("li",{children:"• Enter full or partial name to search by name"}),(0,b.jsx)("li",{children:"• Include @ to search by email address"}),(0,b.jsx)("li",{children:"• Enter numbers to search by phone"}),(0,b.jsx)("li",{children:"• Enter User ID (e.g., SGB2025000002) for exact match"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-5",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Grain Category ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("select",{className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all disabled:bg-gray-50 disabled:cursor-not-allowed",value:a.category_id,onChange:a=>p(b=>({...b,category_id:a.target.value})),disabled:!G,children:[(0,b.jsx)("option",{value:"",children:"Select Grain Type"}),q.length>0?q.map(a=>(0,b.jsxs)("option",{value:a._id,children:[a.grain_type," - ",a.quality]},a._id)):(0,b.jsx)("option",{disabled:!0,children:"Loading..."})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Quantity (Quintal) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)("input",{type:"number",min:"0",step:"0.01",className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"Enter quantity",value:a.quantity,onChange:a=>p(b=>({...b,quantity:a.target.value})),disabled:!G})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:"Current Price (₹/Quintal)"}),(0,b.jsx)("div",{className:"w-full p-3 border-2 border-gray-200 rounded-lg bg-gray-50 flex items-center",children:(0,b.jsxs)("span",{className:"text-lg font-semibold text-gray-700",children:["₹ ",M?.price||"0.00"]})})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Warehouse ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("select",{className:"w-full p-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-white transition-all disabled:bg-gray-50 disabled:cursor-not-allowed",value:a.warehouse_id,onChange:a=>p(b=>({...b,warehouse_id:a.target.value})),disabled:!G,children:[(0,b.jsx)("option",{value:"",children:"Select Warehouse"}),s.length>0?s.map(a=>(0,b.jsxs)("option",{value:a._id,children:[a.name," — ",a.location,a.capacity&&` (Capacity: ${a.capacity} quintals)`]},a._id)):(0,b.jsx)("option",{disabled:!0,children:"Loading..."})]})]}),(0,b.jsxs)("div",{className:"md:col-span-2",children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-700 mb-2",children:["Moisture Content (%) ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,b.jsx)(j.Droplets,{className:"h-5 w-5 text-blue-500"})}),(0,b.jsx)("input",{type:"number",min:"0",max:"100",step:"0.1",className:"w-full pl-10 pr-12 py-3 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white transition-all disabled:bg-gray-50 disabled:cursor-not-allowed",placeholder:"Enter moisture percentage (e.g., 12.5)",value:a.moisture_content,onChange:a=>{let b=a.target.value;(""===b||parseFloat(b)>=0&&100>=parseFloat(b))&&p(a=>({...a,moisture_content:b}))},disabled:!G}),(0,b.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,b.jsx)("span",{className:"text-gray-500 font-medium",children:"%"})})]}),a.moisture_content&&(0,b.jsxs)("div",{className:`mt-2 flex items-center space-x-2 ${14>=parseFloat(a.moisture_content)?"text-green-600":18>=parseFloat(a.moisture_content)?"text-yellow-600":"text-red-600"}`,children:[(0,b.jsx)("div",{className:`h-2 w-2 rounded-full ${14>=parseFloat(a.moisture_content)?"bg-green-500":18>=parseFloat(a.moisture_content)?"bg-yellow-500":"bg-red-500"}`}),(0,b.jsx)("span",{className:"text-sm font-medium",children:14>=parseFloat(a.moisture_content)?"Optimal moisture level":18>=parseFloat(a.moisture_content)?"Acceptable moisture level":"High moisture - may require drying"})]})]})]}),(0,b.jsx)("div",{className:"bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-5",children:(0,b.jsxs)("div",{className:"flex items-start",children:[(0,b.jsx)("div",{className:"p-2 bg-yellow-100 rounded-lg mr-3",children:(0,b.jsx)(e.AlertCircle,{className:"h-5 w-5 text-yellow-600"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h4",{className:"font-semibold text-yellow-900 mb-2",children:"Deposit Terms & Conditions"}),(0,b.jsxs)("ul",{className:"text-sm text-yellow-800 space-y-1.5",children:[(0,b.jsxs)("li",{className:"flex items-start",children:[(0,b.jsx)("span",{className:"mr-2",children:"•"}),(0,b.jsx)("span",{children:"Minimum storage period: 6 months"})]}),(0,b.jsxs)("li",{className:"flex items-start",children:[(0,b.jsx)("span",{className:"mr-2",children:"•"}),(0,b.jsx)("span",{children:"Storage fee: ₹0.20 per quintal per day"})]}),(0,b.jsxs)("li",{className:"flex items-start",children:[(0,b.jsx)("span",{className:"mr-2",children:"•"}),(0,b.jsx)("span",{children:"Quality check is mandatory before deposit"})]}),(0,b.jsxs)("li",{className:"flex items-start",children:[(0,b.jsx)("span",{className:"mr-2",children:"•"}),(0,b.jsx)("span",{children:"Insurance coverage available upon request"})]})]})]})]})}),(0,b.jsxs)("button",{onClick:()=>{if(!a.farmerId)return void l.default.error("Please select a farmer");if(!a.category_id||!a.warehouse_id||!a.quantity||!a.moisture_content)return void l.default.error("Please fill all required fields");let b=q.find(b=>b._id===a.category_id),c=s.find(b=>b._id===a.warehouse_id);x({farmer_name:G.name,farmer_email:G.email,farmer_phone_number:G.phone_number,farmer_image:G.user_image,grainCategory:b?.grain_type||"N/A",grain_id:b?._id||"N/A",grainQuality:b?.quality||"N/A",quantity:a.quantity,warehouse:c?`${c.name} — ${c.location}`:"N/A",currentPrice:M?.price,farmer_userId:G.farmerId,moisture_content:a.moisture_content,transaction_type:a.transaction_type}),v(!0)},type:"button",disabled:!G||!a.category_id||!a.warehouse_id||!a.quantity||!a.moisture_content,className:"w-full bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-700 hover:to-emerald-700 text-white py-3.5 rounded-lg font-semibold transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:hover:shadow-lg flex items-center justify-center space-x-2",children:[(0,b.jsx)(k.ArrowDownCircle,{className:"h-5 w-5"}),(0,b.jsx)("span",{children:"Review & Submit Deposit"})]})]})]})})]})}])}];

//# sourceMappingURL=src_app_manager_deposit_page_jsx_96aa37c3._.js.map